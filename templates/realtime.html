

{% include "layout.html" %}
  <title>Real Time</title>
<script type='text/javascript' src='http://code.jquery.com/jquery-1.8.2.js'></script>
<link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Titillium Web'>

<html lang="en">
<head>
    <meta charset="utf-8">
</head>

<body>
{% include "header.html" %}
<div id='count'>{{count}}</div>

<table>
<tbody>
 <tr>
Tickets Real Time
  </tr>
   <tr>
    <td>Usuario</td>
    <td>Asunto</td>
    <td>Tipo</td> 
    <td>Fecha de Inicio</td>

  {% if estado_name == 'Cerrados' %}
     <td>Fecha de Fin</td>
  {% endif %}

  {% if estado_name == 'Atendidos' %}
      <td>Soporte</td>
  {% endif %}

   
    <td>Estado</td>
    <td>Detalle</td>
    
    <td>Accion</td>

  </tr>



</tbody> 
</table>

<table> 

    <div id='orillamada' class="warning"></div>
    

</table>

{% if ticket %}

<table>
  <tr>Historico de Tickets</tr>
{% for ticket in ticket%}
  

  <tr>
  
  <td width='10%'>{{ticket.cliente}}</td>
  <td width='10%'>{{ticket.asunto}}</td>
  <td width='10%'>{{ticket.tipo}}</td>
  <td width='10%'>{{ticket.fecha_inicio}}</td>
  {% if estado_name == 'Cerrados' %}
    <td width='10%'>{{ticket.fecha_fin}}</td>

  {% endif %}



    {% for soporte in soporte %}

      {% if soporte.ticket_id == ticket.id %}
      <td width='5%'>{{soporte.soporte}}</td>

      {% endif %}
      
    {% endfor %}


  <td width='5%'>{{ticket.estado}}</td>
  <td width='12%'><a href='/detalle_ticket/{{ticket.id}}'>Mas detalle</a></td>
  {% if grupo == 'Soporte' %}
            {% if estado_name == 'Nuevos' %}
            <td width='10%'><a href='/atender/{{ticket.id}}'>Atender</a></td>
            {% endif %}
            {% if estado_name == 'Atendidos' %}
            <td width='12%'><a href='/cerrar/{{ticket.id}}'>Enviar a validar</a></td>
            
            

            {% endif %}
            {% if estado_name == 'En Prueba' %}
            <td width='20%'><a href=''>En Prueba</a></td>
            {% endif %}
            {% if estado_name == 'Cerrados' %}
            <td width='20%'><a href=''>-</a></td>
            {% endif %}
  {% else %}
          {% if estado_name == 'Nuevos' %}
            <td width='10%'><a href=''>-</a></td>
            {% endif %}
            {% if estado_name == 'Atendidos' %}
            <td width='10%'><a href=''>-</a></td>
            {% endif %}
            {% if estado_name == 'En Prueba' %}
            <td width='20%'><a href='/validar/{{ticket.id}}'>Validar</a></td>
            {% endif %}
            {% if estado_name == 'Cerrados' %}
            <td width='20%'><a href=''>-</a></td>
            {% endif %}
  {% endif %}
  </tr>
{% endfor %}


</table>


{% else %}
<a>No hay tickets</a>
{% endif %}


<script type="text/javascript">

i=0  
setInterval('moverItem()',2000);


function moverItem() {
count = $('#count').text()
                       
    
       $.ajax({
                        url : "/realtime_post", 
                        type : "POST",   
                        dataType:"json",                
                        data : {
                            count: count,
                            csrfmiddlewaretoken: '{{ csrf_token }}'
                            },
                            success : function(json) {

								i=i+1
								var trs=$("#orillamada tr").length;
								
								if(trs==20){
								$("#orillamada tr:last").remove();

								}

						  

           

              if (typeof(json.n)!='undefined'){

                console.log(json.data)
/*
                x = $.parseJSON(json.n).counter_act;
                c = $.parseJSON(json.data)
                  $('#orillamada').prepend('<tr><td width=10%>'+c[0].fields.cliente+'</td><td width=10%>'+c[0].fields.asunto+'</td><td width=10%>'+c[0].fields.tipo+'</td><td width=10%>'+c[0].fields.fecha_inicio+'</td><td width=10%>'+c[0].fields.estado+'</td><td width=12%><a href="/detalle_ticket/'+c[0].pk+'">Mas detalle</a></td><td width=10%><a href="/atender/'+c[0].pk+'">Atender</a></td>') 
              }
              else{

                x=json.counter_act
              }


             
               $("#count").text(x)
              
              
						

*/
       
                            },
                    });
                    return false;
}

</script>

<style type="text/css">

td{
 
    border-bottom: 1px solid #5C84C2;
  border-top: 1px solid #5C84C2;


  }






#orillamada{

  
  
  border-bottom: 1px solid #5C84C2;
  border-top: 1px solid #5C84C2;
  font-family: 'Titillium Web';
  color: #575859;
  font-size: 12px;



}

table{


  border-bottom: 1px solid #5C84C2;
  border-top: 1px solid #5C84C2;
  font-family: 'Titillium Web';
  color: #575859;
  font-size: 12px;
  padding: 0;
width:100%;

}




</style>



</body>
</html>


